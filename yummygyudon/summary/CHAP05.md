# 5. 책임 할당하기

앞서 데이터 중심의 접근법을 사용할 경우, 행동보다 데이터를 먼저 결정하고<br/>
협력이라는 문맥을 벗어나 고립된 객체의 상태에 초점이 맞춰쳐 <br/>
<u>캡슐화를 위반</u>하기 쉬울 뿐더러 <br/>요소들 사이의 <u>결합도까지 높아져 코드 변경이 용이하지 않다</u>는 것을 알 수 있었다.

위와 같은 문제점을 해결하기 위한 가장 기본적인 방법은<br/>
데이터가 아닌 책임에 초점을 맞춘 설계이다.


## 책임 주도 설계 원칙
데이터 중심 설계에서 책임 중심의 설계로 전환하기 위해서는 다음과 같은 원칙을 따라야 한다.

### 데이터보다 "행동"
객체에게 진정으로 중요한 것은 데이터가 아니라 "<u>외부에 제공하는 행동</u>".<br/>
즉, 적절히 분리된 퍼블릭 인터페이스를 통해 수행하는 **객체의 책임**이다.

따라서 **데이터**는 <u>객체가 책임을 수행하는 데 필요한 재료를 제공할 뿐</u>이기 떄문에<br/>
데이터에 초점을 맞추지 않고 **행동**으로 무게 중심을 옮겨<br/>
객체의 캡슐화가 약화되지 않고<br/>
높은 응집도와 낮은 결합도를 가질 수 있도록 해야한다.<br/>

기본적으로 객체를 설계하기 위한 질문의 순서를 바꿔<br/>
"_**<u>이 객체가 수행해야 하는 책임은 무엇인가</u>**_"를 <u>먼저 결정한 후</u>에<br/>
"_<u>이 책임을 수행하기 위해 필요한 데이터가 무엇인가</u>_"를 결정하는 것이 바람직하다.

즉, **책임을 먼저 결정한 후에 객체의 상태를 결정**하라는 것이다.

<br/>

### "협력"이라는 문맥안에서 결정
데이터보다 책임(행동)을 중점으로 설계하는 것이 중요하다고 했지만<br/>
사실 할당된 책임이 적절한지는 <u>**협력**에 **적합**한 정도로 결정</u>되는 부분이기 때문에<br/>
**협력에 적합하지 않다면** 아무리 책임을 중점적으로 설계하더라도 <u>그 책임은 잘못된 것</u>이 되는 것이다.

따라서 책임은 객체의 입장에서 생각하는 것이 아닌 <u>객체가 참여하는 **협력의 입장**</u>에서 생각을 해보아야 한다.<br/>
다시 말해 <u>협력을 시작하는 주체</u>는 **메시지 전송자**이기 때문에<br/>
적절한 책임이란 <u>**메시지 전송자**에게 적합한 책임</u>이라는 것이고<br/>
이 말은 곧, 그 <u>메시지를 전송하는 **클라이언트 의도**</u>에 적합한 책임을 할당해야 한다는 것과 같다.

이와 같이 적합한 책임을 설정하기 위해서는 객체가 결정한 후에 메시지를 선택하지 않고
<u>**메시지를 결정한 후**에 이 **메시지를 적절하게 처리해줄 객체**를 선택</u>해야 한다.

**메시지**가 <u>클라이언트의 의도</u>를 표현한 것이라는 것을 잊지 말고<br/>
객체를 결정하기 전에 <u>객체가 **수신할 메시지**를 먼저 결정</u>한다는 점을 주목해야 한다.

<u>상황별로 다양한 클라이언트의 메시지</u>에 대해 대응하고<br/>
책임을 할당 받을 객체를 **메시지 수신 클래스**로 결정하게 되는 것이다.

이렇게 된다면
메시지를 먼저 결정하기 때문에<br/>
<u>전송자 관점</u>에서는 **수신자가 깔끔하게 캡슐화**되는 것이다.

결론적으로 책임 중심의 설계에서의 <br/>
협력이라는 문맥 안에서 객체가 **수행할 책임에 초점**을 맞춰야 한다.

> #### ⟪ 설계 흐름 ⟫
> 1. 시스템이 사용자에게 제공해야 하는 기능인 **시스템 책임을 파악**한다.
> 2. 시스템 책임을 **더 작은 책임으로 분할**한다.
> 3. 분할된 책임을 수행할 수 있는 **적절한 객체 또는 역할을 찾아 책임을 할당**한다.
> 4. 객체가 책임을 <u>수행하는 도중 다른 객체의 도움이 필요한 경우</u>, 이를 **책임질 적절한 객체 또는 역할을 찾는다**.
> 5. 해당 객체 또는 역할에게 책임을 할당함으로써 **두 객체가 협력**하게 한다.

<br/>
<br/>

---
하지만 책임에 초점을 맞춘 설계는 <u>어떤 객체에게 어떤 책임을 할당할지</u> 결정하기 어려울 뿐더러<br/>
<u>트레이드 오프를 계산</u>하여 설계해야 하기 때문에 어려움이 있다.

이 책임 주도 설계의 어려움을 해결해줄 수 있는 기반 패턴이 바론 **GRASP** 패턴이다.

## GRASP 패턴
> [ _**G**eneral **R**esponsibility **A**ssignment **S**oftware **P**atterns_ ]<br/>
> 
> : Object-Oriented 디자인의 핵심은 <u>각 객체에 책임을 부여하는 것</u>.<br/> 
> " **책임을 부여하는 원칙들을 말하고 있는 패턴** " <br/>
> 
> _<span style="color:grey">구체적인 구조는 없지만, 철학을 배울 수 있다.</span>_
 
<br/>

### 도메인 개념
설계 시작 전에 도메인에 대한 **개략적인 모습**을 그려 보는 것이 유용한데

도메인 안에는 수 많은 개념들이 존재하고 이를 책임 할당의 대상으로 사용하게 되면<br/>
해당 내용들을 **코드로 변환**하기 수월할 뿐더러<br/>
어떤 책임을 할당해야 할 때 가장 고민해야할 **후보군을 선정하는 척도**로서 사용될 수도 있고<br/>
그리고 어떤 책임들이 **협력 관계를 맺어야 하는지 가시화** 할 수 있기 때문이다.

*그렇다고 본 단계에서 개념들의 의미와 관계가 정확하고 구체적일 필요는 없다.<br/>
**설계의 시작점**으로서 사용되기 때문에<br/>
<u>너무 많은 시간을 들이는 것은 오히려 손해</u>라 할 수 있으며<br/>
**책임을 할당 받을 큼직한 객체들의 종류와 관계에 대해 유용한 정보만 제공할 수 있다면 충분**하다.*

> #### ⟪ 도메인 모델의 정답 ⟫
> *도메인 모델의 구조가 코드의 구조에 영향을 끼치는 것은 사실이나<br/>
> 유연성이나 재사용성 등과 같이 **실제 코드로 구현하는 과정에서 역으로 도메인의 개념이 바뀌는 것** 또한 사실이다.*
> 
> *즉, 올바른 도메인 모델이란 것은 존재하지 않고<br/>
> <u>구현에 도움이 되는 모델로서 실용적이면서 유용</u>하다면 그것이 정답인 것이다.*

<br/>

### 정보 전문가에게 책임 할당


<br/>

### 높은 응집도 & 낮은 결합도


<br/>

### 창조자에게 객체 생성 책임 할당

<br/>
<br/>

---

### 타입 분리

<br/>

### 다형성 분리

<br/>

### 변경 보호


<br/>

### 변경 & 유연성


<br/>
<br/>

---

## 책임 주도 설계(R.D.D) 대안

### 메서드 응집도

### 자율적 객체
